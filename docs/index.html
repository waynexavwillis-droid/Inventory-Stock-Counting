<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Inventory System with Alerts</title>
  <style>
    body { font-family: Arial, sans-serif; margin:0; display:flex; height:100vh; }
    .sidebar { width:220px; background:#f3f3f3; padding:20px; box-sizing:border-box; }
    .sidebar button { display:block; width:100%; margin-bottom:10px; padding:10px; cursor:pointer; }
    .content { flex:1; padding:20px; box-sizing:border-box; }
    input, button { padding:8px; margin:4px; }
    table { width:80%; margin-top:20px; border-collapse:collapse; }
    table, th, td { border:1px solid black; }
    th, td { padding:8px; text-align:left; }
    .action-btn { padding:4px 8px; margin-right:5px; cursor:pointer; font-weight:bold; font-size:14px; }

    /* --- Modal styles --- */
    .modal {
      position: fixed; inset: 0; display:none;
      align-items:center; justify-content:center;
      background: rgba(0,0,0,0.4); z-index: 9999;
    }
    .modal.open { display:flex; }
    .modal-card {
      width:95%; max-width:460px; background:#fff; border-radius:8px;
      padding:16px 18px; box-shadow:0 10px 30px rgba(0,0,0,0.25);
    }
    .modal-card h3 { margin:0 0 10px; }
    .modal-card label { display:block; margin:10px 0 4px; font-size:14px; }
    .modal-card input, .modal-card textarea { width:100%; box-sizing:border-box; padding:8px; }
    .modal-actions { display:flex; justify-content:flex-end; gap:10px; margin-top:12px; }
    .muted { color:#666; font-size:12px; margin-top:6px; }
  </style>
</head>
<body>

  <div class="sidebar">
    <button onclick="showPage('addPage')">Add New Stock</button>
    <button onclick="showPage('adjustPage')">Adjust Stock</button>
    <button onclick="showPage('goalPage')">Set Stock Count Goal</button>
  </div>

  <div class="content">
    <!-- Add New Stock Page -->
    <div id="addPage">
      <h2>Add New Item</h2>
      <input type="text" id="newItemName" placeholder="Item Name">
      <input type="number" id="newItemQty" placeholder="Quantity">
      <button onclick="addNewItem()">Add Item</button>
      <div class="muted">Tip: data is saved in this browser using localStorage.</div>
    </div>

    <!-- Adjust Stock Page -->
    <div id="adjustPage" style="display:none;">
      <h2>Adjust Stock</h2>
      <table id="stockTable">
        <thead>
          <tr>
            <th>Item Name</th>
            <th>Quantity</th>
            <th>Stock Goal</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <!-- Goal Settings Page -->
    <div id="goalPage" style="display:none;">
      <h2>Set Stock Count Goal</h2>
      <table id="goalTable">
        <thead>
          <tr>
            <th>Item Name</th>
            <th>Current Goal</th>
            <th>New Goal</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <!-- ===== Adjust dialog (opens on + / -) ===== -->
  <div id="adjustModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="adj-title">
    <div class="modal-card">
      <h3 id="adj-title">Adjust Stock</h3>
      <div id="adj-subtitle" class="muted"></div>

      <label for="adj-name">Your name</label>
      <input id="adj-name" type="text" placeholder="e.g., Alice Tan">

      <label for="adj-purpose">Purpose</label>
      <input id="adj-purpose" type="text" placeholder="e.g., customer pickup / audit / transfer">

      <label for="adj-for">For (names)</label>
      <input id="adj-for" type="text" placeholder="e.g., John Lim, Priya Rao">

      <div class="modal-actions">
        <button id="adj-cancel">Cancel</button>
        <button id="adj-confirm">Confirm</button>
      </div>
    </div>
  </div>

  <script>
    // ===== Data (inventory + audit log) in localStorage =====
    let inventory = JSON.parse(localStorage.getItem('inventory')) || [];
    let adjustments = JSON.parse(localStorage.getItem('adjustments')) || []; // audit entries

    function saveInventory() { localStorage.setItem('inventory', JSON.stringify(inventory)); }
    function saveAdjustments() { localStorage.setItem('adjustments', JSON.stringify(adjustments)); }

    function showPage(pageId) {
      document.getElementById('addPage').style.display = 'none';
      document.getElementById('adjustPage').style.display = 'none';
      document.getElementById('goalPage').style.display = 'none';
      document.getElementById(pageId).style.display = 'block';
      if (pageId === 'adjustPage' || pageId === 'goalPage') renderTables();
    }

    // Add new item
    function addNewItem() {
      const name = document.getElementById('newItemName').value.trim();
      const qty  = parseInt(document.getElementById('newItemQty').value);
      if (!name || isNaN(qty) || qty <= 0) return alert("Enter valid name and quantity");

      const existing = inventory.find(i => i.name.toLowerCase() === name.toLowerCase());
      if (existing) { existing.qty += qty; }
      else { inventory.push({ name, qty, goal: 0 }); }

      saveInventory();
      alert(`Item "${name}" added.`);
      document.getElementById('newItemName').value = '';
      document.getElementById('newItemQty').value = '';
    }

    // Render tables
    function renderTables() { renderStockTable(); renderGoalTable(); checkLowStockAlerts(); }

    function renderStockTable() {
      const tbody = document.querySelector('#stockTable tbody');
      tbody.innerHTML = '';
      inventory.forEach((item, index) => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${item.name}</td>
          <td>${item.qty}</td>
          <td>${item.goal}</td>
          <td>
            <button class="action-btn" onclick="openAdjustDialog(${index}, 1)">+</button>
            <button class="action-btn" onclick="openAdjustDialog(${index}, -1)">-</button>
          </td>
        `;
        tbody.appendChild(row);
      });
    }

    function renderGoalTable() {
      const tbody = document.querySelector('#goalTable tbody');
      tbody.innerHTML = '';
      inventory.forEach((item, index) => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${item.name}</td>
          <td>${item.goal}</td>
          <td><input type="number" id="newGoal-${index}" placeholder="New Goal"></td>
          <td><button onclick="updateGoal(${index})">Update</button></td>
        `;
        tbody.appendChild(row);
      });
    }

    function updateGoal(index) {
      const newGoal = parseInt(document.getElementById(`newGoal-${index}`).value);
      if (isNaN(newGoal) || newGoal < 0) return alert("Enter valid stock goal");
      inventory[index].goal = newGoal;
      saveInventory();
      renderGoalTable();
      alert(`Stock goal updated for ${inventory[index].name}`);
    }

    // ====== Low stock alert ======
    function checkLowStockAlerts() {
      inventory.forEach(item => {
        if (item.goal > 0 && item.qty <= item.goal) {
          // optional: throttle alerts by marking a flag on the item
          alert(`Low stock for "${item.name}"`);
        }
      });
    }

    // ====== Adjust dialog logic ======
    let pending = { index: null, delta: 0 };

    function openAdjustDialog(index, delta) {
      pending = { index, delta };
      const item = inventory[index];
      document.getElementById('adj-title').textContent =
        `Adjust "${item.name}"`;
      document.getElementById('adj-subtitle').textContent =
        `Change: ${delta > 0 ? '+' : ''}${delta} | Current qty: ${item.qty}`;
      document.getElementById('adj-name').value = '';
      document.getElementById('adj-purpose').value = '';
      document.getElementById('adj-for').value = '';
      document.getElementById('adjustModal').classList.add('open');
      // focus first input
      setTimeout(() => document.getElementById('adj-name').focus(), 0);
    }
    function closeAdjustDialog() {
      document.getElementById('adjustModal').classList.remove('open');
    }
    document.getElementById('adj-cancel').addEventListener('click', closeAdjustDialog);
    document.getElementById('adjustModal').addEventListener('click', (e) => {
      if (e.target.id === 'adjustModal') closeAdjustDialog(); // click outside card
    });

    document.getElementById('adj-confirm').addEventListener('click', () => {
      const actor   = document.getElementById('adj-name').value.trim();
      const purpose = document.getElementById('adj-purpose').value.trim();
      const forWhom = document.getElementById('adj-for').value.trim();
      if (!actor || !purpose || !forWhom) {
        alert('Please fill in Your name, Purpose, and For (names).');
        return;
      }

      const item = inventory[pending.index];
      // apply adjustment
      item.qty += pending.delta;
      if (item.qty < 0) item.qty = 0;

      // log audit entry
      adjustments.push({
        ts: new Date().toISOString(),
        item: item.name,
        delta: pending.delta,
        actor, purpose, forWhom,
        qtyAfter: item.qty
      });
      saveInventory();
      saveAdjustments();

      renderStockTable();
      checkLowStockAlerts();
      closeAdjustDialog();
    });

    // Initial render
    renderTables();
  </script>
</body>
</html>
